<div class="page-container">
  <header class="page-header">
    <div class="header-content">
      <h1>Relatório de Reservas</h1>
      <p>Visão geral de todos os agendamentos do sistema</p>
    </div>
  </header>

  <div class="filters-section">
    <div class="search-wrapper">
      <span class="search-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#999"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </span>
      <input
        type="text"
        placeholder="Pesquisar por aluno ou laboratório..."
        (input)="onSearch($event)"
      />
    </div>

    <div class="date-wrapper">
      <input
        type="date"
        (change)="onDateChange($event)"
        class="date-input"
        [ngModel]="selectedDate"
      />
    </div>
  </div>

  <div
    class="table-container"
    *ngIf="reservations && reservations.length > 0; else emptyState"
  >
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Horário</th>
          <th>Laboratório</th>
          <th>Solicitante</th>
          <th>Status</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let res of reservations">
          <td>
            <div class="info-pill date">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              {{ res.reservationDate | date : "dd/MM/yyyy" }}
            </div>
          </td>

          <td>
            <div class="standard-time-pill">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span class="time-val">{{ res.startTime | date : "HH:mm" }}</span>
              <span class="separator">até</span>
              <span class="time-val">{{ res.endTime | date : "HH:mm" }}</span>
            </div>
          </td>

          <td class="lab-name">{{ res.laboratoryName }}</td>

          <td>
            <div class="user-cell">
              <div class="avatar-circle">
                {{ res.userName ? res.userName.charAt(0).toUpperCase() : "?" }}
              </div>
              <span class="user-name">{{ res.userName }}</span>
            </div>
          </td>

          <td>
            <span class="status-badge" [ngClass]="res.status?.toLowerCase()">
              {{
                res.status === "Confirmed"
                  ? "Confirmado"
                  : res.status === "Cancelled"
                  ? "Cancelado"
                  : res.status
              }}
            </span>
          </td>

          <td class="text-center">
            <button
              *ngIf="res.status !== 'Cancelled'"
              class="btn-icon delete"
              (click)="openCancelModal(res)"
              title="Cancelar Reserva"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" *ngIf="reservations && reservations.length > 0">
    <button (click)="prevPage()" [disabled]="!hasPrevious">← Anterior</button>
    <span class="page-info"
      >Página <strong>{{ currentPage }}</strong> de
      <strong>{{ totalPages }}</strong></span
    >
    <button (click)="nextPage()" [disabled]="!hasNext">Próximo →</button>
  </div>

  <ng-template #emptyState>
    <div class="empty-state">
      <p>Nenhuma reserva encontrada.</p>
    </div>
  </ng-template>

  <app-confirmation-modal
    *ngIf="showCancelModal"
    title="Cancelar Reserva"
    [message]="
      'Tem certeza que deseja cancelar o agendamento de <b>' +
      selectedReservation?.userName +
      '</b>?'
    "
    confirmButtonText="Sim, Cancelar"
    (confirm)="confirmCancel()"
    (cancel)="closeCancelModal()"
  >
  </app-confirmation-modal>
</div>
