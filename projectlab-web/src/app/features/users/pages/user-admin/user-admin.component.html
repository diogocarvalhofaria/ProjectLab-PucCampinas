<div class="page-container">
  <header class="page-header">
    <div class="header-content">
      <h1>Gestão de Usuários</h1>
      <p>Controle de alunos, professores e administradores</p>
    </div>

    <div class="header-actions">
      <button (click)="openModal()" class="btn-primary">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Novo Usuário
      </button>
    </div>
  </header>

  <div class="filters-section">
    <div class="search-wrapper">
      <span class="search-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#999"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </span>
      <input
        type="text"
        placeholder="Buscar por nome ou e-mail..."
        (input)="onSearch($event)"
      />
    </div>

    <div class="filter-wrapper">
      <span class="filter-label">Filtrar por Cargo:</span>
      <select (change)="onFilterRole($event)">
        <option value="">Todos os Cargos</option>
        <option value="Admin">Administrador</option>
        <option value="Professor">Professor</option>
        <option value="Student">Aluno</option>
      </select>
    </div>
  </div>

  <div class="user-grid" *ngIf="users.length > 0">
    <div class="user-card" *ngFor="let user of users">
      <div class="card-header">
        <div class="user-info">
          <h3>{{ user.name }}</h3>
          <span class="role-badge" [ngClass]="user.role.toLowerCase()">
            {{ user.role }}
          </span>
        </div>
      </div>

      <div class="card-body">
        <div class="detail-row">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
            ></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <span>{{ user.email }}</span>
        </div>

        <div class="detail-row">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="4" width="18" height="16" rx="2"></rect>
            <circle cx="9" cy="10" r="2"></circle>
            <line x1="15" y1="8" x2="17" y2="8"></line>
            <line x1="15" y1="12" x2="17" y2="12"></line>
            <line x1="7" y1="16" x2="17" y2="16"></line>
          </svg>
          <span
            >RA: <strong>{{ user.ra }}</strong></span
          >
        </div>

        <div class="detail-row" *ngIf="user.phoneNumber">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
          </svg>
          <span>{{ user.phoneNumber }}</span>
        </div>

        <div class="detail-row location" *ngIf="user.cidade">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <span>{{ user.cidade }} - {{ user.estado }}</span>
        </div>
      </div>

      <div class="card-actions">
        <button class="btn-icon edit" (click)="editUser(user)" title="Editar">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
            ></path>
            <path
              d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
            ></path>
          </svg>
          Editar
        </button>

        <button
          class="btn-icon delete"
          (click)="openDeleteModal(user)"
          title="Excluir"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="3 6 5 6 21 6"></polyline>
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            ></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Excluir
        </button>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="users.length === 0">
    <p>Nenhum usuário encontrado com os filtros atuais.</p>
  </div>

  <div class="pagination" *ngIf="users.length > 0">
    <button (click)="prevPage()" [disabled]="!hasPrevious">← Anterior</button>
    <span class="page-info"
      >Página <strong>{{ currentPage }}</strong> de
      <strong>{{ totalPages }}</strong></span
    >
    <button (click)="nextPage()" [disabled]="!hasNext">Próximo →</button>
  </div>

  <app-modal-wrapper
    *ngIf="showModal"
    [title]="isEditing ? 'Editar Usuário' : 'Novo Usuário'"
    (close)="closeModal()"
  >
    <app-user-form
      [userData]="selectedUser"
      (saved)="onUserSaved()"
      (cancelled)="closeModal()"
    ></app-user-form>
  </app-modal-wrapper>

  <app-confirmation-modal
    *ngIf="showDeleteModal"
    title="Excluir Usuário"
    [message]="
      'Tem certeza que deseja excluir o usuário ' +
      userToDelete?.name +
      '? Esta ação não pode ser desfeita.'
    "
    confirmButtonText="Sim, Excluir"
    (confirm)="confirmDelete()"
    (cancel)="closeDeleteModal()"
  >
  </app-confirmation-modal>
</div>
